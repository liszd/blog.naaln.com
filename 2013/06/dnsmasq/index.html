<!DOCTYPE html>







<html class="theme-next muse" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="ByVfaP_E3b9ZYRUGhNAUFSQKL8mJQwUehpQwoxJ5n-c" />



  <meta name="msvalidate.01" content="DB220684085BEDBD2E49E8E942534B1F" />


















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.2.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32-next.png?v=6.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16-next.png?v=6.2.0">


  <link rel="mask-icon" href="/favicon/logo.svg?v=6.2.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.2.0',
    sidebar: {"position":"right","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'XILKIWTAM9',
      apiKey: '7f52dfb146098112a1859b59b8e1003c',
      indexName: 'blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"搜索文章","hits_empty":"啊，找不到 ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="DnsmasqDnsmasq is lightweight, easy to configure DNS forwarder and DHCP server. It is designed to provide DNS and, optionally, DHCP, to a small network. It can serve the names of local machines which">
<meta name="keywords" content="dnsmasq">
<meta property="og:type" content="article">
<meta property="og:title" content="Dnsmasq">
<meta property="og:url" content="https://blog.naaln.com/2013/06/dnsmasq/index.html">
<meta property="og:site_name" content="Why·Liam·Blog">
<meta property="og:description" content="DnsmasqDnsmasq is lightweight, easy to configure DNS forwarder and DHCP server. It is designed to provide DNS and, optionally, DHCP, to a small network. It can serve the names of local machines which">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-09-03T09:15:57.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dnsmasq">
<meta name="twitter:description" content="DnsmasqDnsmasq is lightweight, easy to configure DNS forwarder and DHCP server. It is designed to provide DNS and, optionally, DHCP, to a small network. It can serve the names of local machines which">



  <link rel="alternate" href="/atom.xml" title="Why·Liam·Blog" type="application/atom+xml" />




  <link rel="canonical" href="https://blog.naaln.com/2013/06/dnsmasq/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Dnsmasq | Why·Liam·Blog</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-47966442-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47966442-2');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?4144ef291e4808d1a8fdfc8a833143ca";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

  
<script src="//msite.baidu.com/sdk/c.js?appid=1586840953097399"></script>
<link rel="canonical" href="https://blog.naaln.com/2013/06/dnsmasq/"/>
<script type="application/ld+json">
    {
        "@context": "https://ziyuan.baidu.com/contexts/cambrian.jsonld",
        "@id": "https://blog.naaln.com/2013/06/dnsmasq/",
        "appid": "1586840953097399",
        "title": "Dnsmasq",
        "images": [
            ""
            ],
        "description": "",
        "pubDate": "",
        "upDate": "",
        "lrDate": ""
    }
</script>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Why·Liam·Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">人生若如初見</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-technology">
    <a href="/categories/technology/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-code"></i> <br />技术</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-jottings">
    <a href="/categories/jottings/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-language"></i> <br />随笔</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tour">
    <a href="/categories/tour/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-globe"></i> <br />旅游</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.naaln.com/2013/06/dnsmasq/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WHY·LIAM">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="//tva2.sinaimg.cn/crop.0.0.998.998.180/48910e01gw1ef5p6etuzdj20rs0rs771.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Why·Liam·Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Dnsmasq
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2013-06-22 05:56:00" itemprop="dateCreated datePublished" datetime="2013-06-22T05:56:00+08:00">2013-06-22</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/technology/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2013/06/dnsmasq/#SOHUCS" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2013/06/dnsmasq/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Dnsmasq"><a href="#Dnsmasq" class="headerlink" title="Dnsmasq"></a>Dnsmasq</h1><p><a href="http://en.wikipedia.org/wiki/Dnsmasq" title="http://en.wikipedia.org/wiki/Dnsmasq" target="_blank" rel="noopener">Dnsmasq</a> is lightweight, easy to configure DNS forwarder and DHCP server. It is designed to provide DNS and, optionally, DHCP, to a small network. It can serve the names of local machines which are not in the global DNS. The DHCP server integrates with the DNS server and allows machines with DHCP-allocated addresses to appear in the DNS with names configured either in each host or in a central configuration file. Dnsmasq supports static and dynamic DHCP leases and BOOTP for network booting of disk-less machines. </p>
<p>It is already installed and preconfigured on OpenWrt. See → <a href="http://wiki.openwrt.org/doc/uci/dhcp" title="doc:uci:dhcp" target="_blank" rel="noopener">/etc/config/dhcp</a>. </p>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>The configuration is done with help of the uci-configuration file: <a href="http://wiki.openwrt.org/doc/uci/dhcp" title="doc:uci:dhcp" target="_blank" rel="noopener">/etc/config/dhcp</a>, but you can use this together with the file <code>[/etc/dnsmasq.conf](http://wiki.openwrt.org/doc/uci/dhcp?&amp;#using_plain_dnsmasqconf &quot;doc:uci:dhcp&quot;)</code>. </p>
<p>Depending on the setting in the uci-file, you may also use the files <code>/etc/ethers</code> and <code>/etc/hosts</code> additionally. </p>
<h3 id="etc-config-dhcp"><a href="#etc-config-dhcp" class="headerlink" title="/etc/config/dhcp"></a>/etc/config/dhcp</h3><p>→ <a href="http://wiki.openwrt.org/doc/uci/dhcp" title="doc:uci:dhcp" target="_blank" rel="noopener">/etc/config/dhcp</a> is a UCI configuration file and as such documented exclusively in <a href="http://wiki.openwrt.org/doc/uci" title="doc:uci" target="_blank" rel="noopener">uci</a>. Almost all settings can be configured with it! </p>
<h3 id="etc-dnsmasq-conf"><a href="#etc-dnsmasq-conf" class="headerlink" title="/etc/dnsmasq.conf"></a>/etc/dnsmasq.conf</h3><p>You can use <code>/etc/dnsmasq.conf</code> in addition, see above. </p>
<p>Example: By default, dnsmasq comes configured to put your hosts into the <code>.lan</code> domain. This is specified in the configuration file as: </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># allow /etc/hosts and dhcp lookups via *.lan</span></span><br><span class="line"><span class="attr">local</span>=/lan/</span><br><span class="line"><span class="attr">domain</span>=lan</span><br></pre></td></tr></table></figure>
<p>You can change this to whatever you’d like your home domain to be. Also, if you want your hosts to be available via your home domain without having to specify the domain in your </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>
<p>file, add the <code>expand-hosts</code> directive to your <code>/etc/dnsmasq.conf</code>-file. </p>
<p>As an example, without <code>expand-hosts</code>, you can only reach <em>router, ubuntu-desktop and ubuntu-laptop</em>. With <em>expand-hosts</em> on, you can reach <em>router, router.lan, ubuntu-desktop, ubuntu-desktop.lan, etc</em>. This probably matches what you’re looking for anyway. </p>
<p>Without this setting, you’ll have to add <em>.lan</em> entries to your <code>/etc/hosts</code>. </p>
<h3 id="etc-ethers"><a href="#etc-ethers" class="headerlink" title="/etc/ethers"></a>/etc/ethers</h3><p>In <code>/etc/ethers</code> static lease entries can be assigned. See → <a href="http://wiki.openwrt.org/doc/uci/dhcp#static_leases" title="doc:uci:dhcp" target="_blank" rel="noopener">static_leases</a>. </p>
<h3 id="etc-hosts"><a href="#etc-hosts" class="headerlink" title="/etc/hosts"></a>/etc/hosts</h3><p>In <code>/etc/hosts</code> DNS entries are configured. dnsmasq will utilize these entries to answer DNS queries on your network. </p>
<p>Format:<br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">IP_address</span>] host_name host_name_short ...</span><br></pre></td></tr></table></figure></p>
<p>Example: </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.1</span> <span class="selector-tag">router</span> <span class="selector-tag">OpenWrt</span> <span class="selector-tag">localhost</span></span><br><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.2</span> <span class="selector-tag">debian-server</span></span><br><span class="line">192<span class="selector-class">.168</span><span class="selector-class">.1</span><span class="selector-class">.3</span> <span class="selector-tag">ubuntu-laptop</span></span><br></pre></td></tr></table></figure>
<h3 id="DNS-and-DHCP-Ports"><a href="#DNS-and-DHCP-Ports" class="headerlink" title="DNS and DHCP Ports"></a>DNS and DHCP Ports</h3><p>DNS needs TCP and UDP port 53 open on the firewall. DHCP needs UDP ports 67 and 68 open from your zone to/from the firewall. See <a href="http://wiki.openwrt.org/doc/recipes/guest-wlan" title="http://wiki.openwrt.org/doc/recipes/guest-wlan" target="_blank" rel="noopener">http://wiki.openwrt.org/doc/recipes/guest-wlan</a> and <a href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html" title="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html" target="_blank" rel="noopener">http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html</a> (viz “–dhcp-alternate-port”) for more information. </p>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Add-a-secondary-DNS"><a href="#Add-a-secondary-DNS" class="headerlink" title="Add a secondary DNS"></a>Add a secondary DNS</h3><p>What to do if you already have a DNS server(secondary DNS server) but you want your router(primary DNS server) to resolve some of the DNS queries? Simply do the following: </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">rm</span> /etc/resolv.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<p>That will remove the resolv.conf symlink. Then we will add the ip address of the secondary DNS inside the /etc/resolv.conf file<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo <span class="string">"nameserver 192.168.1.2"</span><span class="variable">&amp;gt</span>;<span class="meta-keyword">/etc/</span>resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>Replace 192.168.1.2 by the ip of your dns server then reboot or restart the dnsmasq service.<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">reboot</span></span><br></pre></td></tr></table></figure></p>
<p>or<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">killall dnsmasq</span><br><span class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/dnsmasq start</span></span><br></pre></td></tr></table></figure></p>
<p>Then you’ll need to set up your secondary dns for resolving internet’s DNS queries: ssh into your router then:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/resolv<span class="selector-class">.conf</span><span class="selector-class">.auto</span></span><br></pre></td></tr></table></figure></p>
<p>it will give you something like this:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">nameserver</span> 212<span class="selector-class">.68</span><span class="selector-class">.193</span><span class="selector-class">.110</span></span><br><span class="line"><span class="selector-tag">nameserver</span> 212<span class="selector-class">.68</span><span class="selector-class">.193</span><span class="selector-class">.196</span></span><br></pre></td></tr></table></figure></p>
<p>Copy the information and then add it to your secondary DNS’s /etc/resolv.conf: into your secondary dns do:<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm <span class="meta-keyword">/etc/</span>resolv.conf</span><br><span class="line">echo <span class="string">"nameserver 212.68.193.110"</span><span class="variable">&amp;gt</span>;<span class="variable">&amp;gt</span>;<span class="meta-keyword">/etc/</span>resolv.conf</span><br><span class="line">echo <span class="string">"nameserver 212.68.193.196"</span><span class="variable">&amp;gt</span>;<span class="variable">&amp;gt</span>;<span class="meta-keyword">/etc/</span>resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>Replace 212.68.193.110 and 212.68.193.196 with the IP addresses you have gotten with the cat /tmp/resolv.conf.auto command. </p>
<h3 id="Configuring-dnsmasq-to-forward-dns-requests-to-public-dns-servers"><a href="#Configuring-dnsmasq-to-forward-dns-requests-to-public-dns-servers" class="headerlink" title="Configuring dnsmasq to forward dns requests to public dns servers"></a>Configuring dnsmasq to forward dns requests to public dns servers</h3><p>If you want to use public dns servers<em><a href="#fn__1">1)</a></em> to resolve public dns queries, you can configure dnsmasq for it. You can even specify more than three nameservers<em><a href="#fn__2">2)</a></em>. </p>
<p>Just add the following lines to /etc/dnsmasq.conf to use Google Public DNS.<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">server=<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">server=<span class="number">8.8</span><span class="number">.4</span><span class="number">.4</span></span><br></pre></td></tr></table></figure></p>
<p>In case you prefer to use <a href="http://wiki.openwrt.org/doc/techref/uci" title="doc:techref:uci" target="_blank" rel="noopener">OpenWrt UCI</a>, you may issue the following commands.<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uci add_list dhcp.@dnsmasq[<span class="number">-1</span>].server=<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span></span><br><span class="line">uci add_list dhcp.@dnsmasq[<span class="number">-1</span>].server=<span class="number">8.8</span><span class="number">.4</span><span class="number">.4</span></span><br><span class="line">uci commit dhcp</span><br></pre></td></tr></table></figure></p>
<p>You may also edit /etc/config/dhcp directly. </p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">config dnsmasq</span><br><span class="line">    <span class="keyword">option</span> domainneeded <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">option</span> boguspriv <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">option</span> localise_queries <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">option</span> local <span class="string">'/lan/'</span></span><br><span class="line">    <span class="keyword">option</span> domain <span class="string">'lan'</span></span><br><span class="line">    <span class="keyword">option</span> expandhosts <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">option</span> authoritative <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">option</span> readethers <span class="string">'1'</span></span><br><span class="line">    <span class="keyword">option</span> leasefile <span class="string">'/tmp/dhcp.leases'</span></span><br><span class="line">    <span class="keyword">option</span> resolvfile <span class="string">'/tmp/resolv.conf.auto'</span></span><br><span class="line">    <span class="keyword">option</span> rebind_protection <span class="string">'0'</span></span><br><span class="line">    <span class="keyword">option</span> server <span class="string">'8.8.8.8'</span></span><br><span class="line">    <span class="keyword">option</span> server <span class="string">'8.8.4.4'</span></span><br></pre></td></tr></table></figure>
<p>In case you want to use OpenDNS (there are 4 public dns servers) </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uci add_list dhcp.@dnsmasq[<span class="number">-1</span>].server=<span class="number">202.67</span><span class="number">.222</span><span class="number">.222</span></span><br><span class="line">uci add_list dhcp.@dnsmasq[<span class="number">-1</span>].server=<span class="number">202.67</span><span class="number">.220</span><span class="number">.220</span></span><br><span class="line">uci add_list dhcp.@dnsmasq[<span class="number">-1</span>].server=<span class="number">202.67</span><span class="number">.222</span><span class="number">.220</span></span><br><span class="line">uci add_list dhcp.@dnsmasq[<span class="number">-1</span>].server=<span class="number">202.67</span><span class="number">.220</span><span class="number">.222</span></span><br><span class="line">uci commit dhcp</span><br></pre></td></tr></table></figure>
<p>Of course, you can use another dns servers. Just send a SIGHUP to dnsmasq process or restart dnsmasq service to apply the newly added forwarding DNS servers. </p>
<h3 id="Configuring-dnsmasq-to-use-different-IP-ranges-for-wired-and-wireless"><a href="#Configuring-dnsmasq-to-use-different-IP-ranges-for-wired-and-wireless" class="headerlink" title="Configuring dnsmasq to use different IP ranges for wired and wireless"></a>Configuring dnsmasq to use different IP ranges for wired and wireless</h3><p>Suppose you have the following: </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">vlan0</span>     <span class="selector-tag">Link</span> <span class="selector-tag">encap</span><span class="selector-pseudo">:Ethernet</span>  <span class="selector-tag">HWaddr</span> <span class="selector-tag">XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span></span><br><span class="line">          <span class="selector-tag">inet</span> <span class="selector-tag">addr</span><span class="selector-pseudo">:192.168.1.1</span>    <span class="selector-tag">Bcast</span><span class="selector-pseudo">:192.168.1.255</span>    <span class="selector-tag">Mask</span><span class="selector-pseudo">:255.255.255.0</span></span><br><span class="line"><span class="selector-tag">eth1</span>      <span class="selector-tag">Link</span> <span class="selector-tag">encap</span><span class="selector-pseudo">:Ethernet</span>  <span class="selector-tag">HWaddr</span> <span class="selector-tag">XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span><span class="selector-pseudo">:XX</span></span><br><span class="line">          <span class="selector-tag">inet</span> <span class="selector-tag">addr</span><span class="selector-pseudo">:10.75.9.1</span>      <span class="selector-tag">Bcast</span><span class="selector-pseudo">:10.75.9.255</span>      <span class="selector-tag">Mask</span><span class="selector-pseudo">:255.255.255.0</span></span><br></pre></td></tr></table></figure>
<p>Simply put 2 “dhcp-range” options in your </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/</span>dnsmasq.conf</span><br></pre></td></tr></table></figure>
<p>file:</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># dhcp-range=[network-id,],[[,],][,]</span><br><span class="line">dhcp-range=lan,<span class="number">192.168</span><span class="number">.1</span><span class="number">.101</span>,<span class="number">192.168</span><span class="number">.1</span><span class="number">.104</span>,<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>,<span class="number">24</span>h</span><br><span class="line">dhcp-range=wlan,<span class="number">10.75</span><span class="number">.9</span><span class="number">.111</span>,<span class="number">10.75</span><span class="number">.9</span><span class="number">.119</span>,<span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span>,<span class="number">2</span>h</span><br></pre></td></tr></table></figure>
<p>You can then use the different “network-id” values with “dhcp-option” to customize the options your DHCP server will supply to your wired and wireless DHCP clients. </p>
<p>for example </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> the<span class="built_in"> default route </span><span class="keyword">for</span> dhcp clients on the wlan side <span class="keyword">to</span> 10.10.6.33</span><br><span class="line"><span class="attribute">dhcp-option</span>=wlan,3,10.10.6.33</span><br><span class="line"><span class="comment">#set the dns server for the dhcp clients on the wlan side to 10.10.6.33</span></span><br><span class="line"><span class="attribute">dhcp-option</span>=wlan,6,10.10.6.33</span><br><span class="line"><span class="comment">#set the default route for dhcp clients on the lan side to 10.10.6.1</span></span><br><span class="line"><span class="attribute">dhcp-option</span>=lan,3,10.10.6.1</span><br><span class="line"><span class="comment">#set the dns server for the dhcp clients on the lan side to 10.10.6.1</span></span><br><span class="line"><span class="attribute">dhcp-option</span>=lan,6,10.10.6.1</span><br></pre></td></tr></table></figure>
<h3 id="Configuring-dnsmasq-to-generate-DHCP-responses-to-ONLY-known-clients"><a href="#Configuring-dnsmasq-to-generate-DHCP-responses-to-ONLY-known-clients" class="headerlink" title="Configuring dnsmasq to generate DHCP responses to ONLY known clients"></a>Configuring dnsmasq to generate DHCP responses to ONLY known clients</h3><p>There are situations where you want dnsmasq to generate DHCP addresses for only known clients (as defined in <code>/etc/ethers</code>). First, set <code>lan_dhcp_num=0</code> to indicate that no addresses are to be generated. Then, modify the file </p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">`/etc/init.d/S60dnsmasq` <span class="built_in">to</span> included <span class="keyword">the</span> <span class="keyword">lines</span> </span><br><span class="line">       <span class="keyword">if</span> [ <span class="string">"$&#123;num:-150&#125;"</span> = <span class="string">"0"</span> ]; <span class="keyword">then</span></span><br><span class="line">               END=static</span><br><span class="line">       fi</span><br></pre></td></tr></table></figure>
<p>after the calls to </p>
<p><code>ipcalc.sh</code> . Restart the daemon or reboot. </p>
<h3 id="Configuring-dnsmasq-to-associate-client-hostnames-with-DHCP-supplied-IP-addresses"><a href="#Configuring-dnsmasq-to-associate-client-hostnames-with-DHCP-supplied-IP-addresses" class="headerlink" title="Configuring dnsmasq to associate client hostnames with DHCP-supplied IP addresses"></a>Configuring dnsmasq to associate client hostnames with DHCP-supplied IP addresses</h3><p>You will need the following lines in your </p>
<p><code>/etc/dnsmasq.conf</code> file: (Adjust IP address if your router is not 192.168.1.1) </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dhcp-option=<span class="number">3</span>,<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">dhcp-option=<span class="number">6</span>,<span class="number">192.168</span><span class="number">.1</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
<p>That’s it for dnsmasq on the router. The trick is that the DHCP client must send its hostname during the DHCP negotiation. The </p>
<p><code>dhclient.conf</code> file, which may be in <code>/etc/</code> (debian) or <code>/etc/dhcp3/</code> (kubuntu), needs to have a single line uncommented and edited: <code>send host-name &quot;hostname&quot;;</code></p>
<p>Save the file, then restart the interface. Repeat on all client systems. </p>
<h3 id="Configuring-dnsmasq-to-broadcast-WINS-server-information"><a href="#Configuring-dnsmasq-to-broadcast-WINS-server-information" class="headerlink" title="Configuring dnsmasq to broadcast WINS server information"></a>Configuring dnsmasq to broadcast WINS server information</h3><p>You will need the following line in your </p>
<p><code>/etc/dnsmasq.conf</code> file: (Adjust IP address if your WINS server is not 192.168.1.2) <code>dhcp-option=44,192.168.1.2</code></p>
<p>Now as your machines release and renew DHCP information they will obtain the address of the WINS server automatically. </p>
<h3 id="Configuring-dnsmasq-to-broadcast-External-DNS-server-information"><a href="#Configuring-dnsmasq-to-broadcast-External-DNS-server-information" class="headerlink" title="Configuring dnsmasq to broadcast External DNS server information"></a>Configuring dnsmasq to broadcast External DNS server information</h3><p>The following change to your <code>/etc/dnsmasq.conf</code> file will allow for automatic configuration of your DHCP clients to use DNS servers other than one on the router. </p>
<p><code>dhcp-option=6,ipaddress1,ipaddress2</code></p>
<p>Or you can do the same in <code>/etc/config/dhcp</code>: </p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">...</span></span><br><span class="line">config <span class="string">'dhcp'</span> <span class="string">'lan'</span></span><br><span class="line">    <span class="built_in">list</span> <span class="string">'dhcp_option'</span> <span class="string">'6,ipaddress1,ipaddress2'</span></span><br><span class="line"><span class="params">...</span></span><br></pre></td></tr></table></figure>
<p>As your machines release and renew their DHCP configuration they will obtain the address of the new DNS servers automatically. </p>
<h3 id="SIP-Phones-and-dnsmasq"><a href="#SIP-Phones-and-dnsmasq" class="headerlink" title="SIP-Phones and dnsmasq"></a>SIP-Phones and dnsmasq</h3><p>By default, the option filterwin2k in dnsmasq is activated, which seems to cause to block queries for <code>SRV</code> records. </p>
<p><code>SRV</code> records are <strong>not only used by Windows</strong> computers to find their domaincontrollers but also used by e.g SIP-Phones to find the server responsible for a given domain. </p>
<p><code>SRV</code> records are a kind of generalized <code>MX</code> records. </p>
<p>Therefore, the <code>filterwin2k</code> option needs to be disabled in order to let SIP-Phones work that use dnsmasq as their DNS server. </p>
<p>Commented out in <code>/etc/dnsmasq.conf</code> or de-activate it in the web-interface. </p>
<p>Or you can do the same in <code>/etc/config/dhcp</code>: </p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">config</span> <span class="string">'dnsmasq'</span></span><br><span class="line">    option <span class="string">'filterwin2k'</span> <span class="string">'0'</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h3 id="DNS-filtering"><a href="#DNS-filtering" class="headerlink" title="DNS filtering"></a>DNS filtering</h3><ul>
<li><a href="https://forum.openwrt.org/viewtopic.php?id=35023" title="https://forum.openwrt.org/viewtopic.php?id=35023" target="_blank" rel="noopener">OpenWrt Forum: Blocking tracking, ad, spyware sites from router</a></li>
</ul>
<h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="log-continuously-filled-with-DHCPINFORM-DHCPACK"><a href="#log-continuously-filled-with-DHCPINFORM-DHCPACK" class="headerlink" title="log continuously filled with DHCPINFORM / DHCPACK"></a>log continuously filled with DHCPINFORM / DHCPACK</h3><p>Windows 7 among others ask for proxy settings using DHCP. The issue is that they do not stop asking until they have received an answer. This results in that the log contains a lot information about these requests, an example can be found below (thanks for <a href="http://wiki.excito.org" title="http://wiki.excito.org" target="_blank" rel="noopener">http://wiki.excito.org</a> for the info).<br>   Jul 1 06:34:09 MorganB3 dnsmasq-dhcp[1638]: DHCPINFORM(br0) 10.69.10.59 00:23:14:c5:33:fc<br>   Jul 1 06:34:09 MorganB3 dnsmasq-dhcp[1638]: DHCPACK(br0) 10.69.10.59 00:23:14:c5:33:fc MorgansVaioF12Z</p>
<p>To solve this, edit /etc/dnsmasq.conf and add the following lines: </p>
<h1 id="This-will-tell-DHCP-clients-to-not-ask-for-proxy-information"><a href="#This-will-tell-DHCP-clients-to-not-ask-for-proxy-information" class="headerlink" title="This will tell DHCP clients to not ask for proxy information"></a>This will tell DHCP clients to not ask for proxy information</h1><h1 id="Some-clients-like-Windows-7-will-constantly-ask-if-not-told-NO"><a href="#Some-clients-like-Windows-7-will-constantly-ask-if-not-told-NO" class="headerlink" title="Some clients, like Windows 7, will constantly ask if not told NO"></a>Some clients, like Windows 7, will constantly ask if not told NO</h1><p>   dhcp-option=252,”\n”</p>
<p>and restart dnsmasq with /etc/init.d/dnsmasq restart </p>
<h3 id="Assigning-dnsmasq-Queryport"><a href="#Assigning-dnsmasq-Queryport" class="headerlink" title="Assigning dnsmasq Queryport"></a>Assigning dnsmasq Queryport</h3><p>The queryport is not the dns server port used by dhcp clients, it is the outgoing port dnsmasq uses to query other servers, and is integral to dnsmasq succesfully assigning DNS values to the DHCP clients. The default settings create arbitrary high port number connections on a range of ports. By assigning an option line like “ option queryport ‘30000’ “ in /etc/config/dhcp, one can constrain those connections to a port you assign. Be certain that your firewall allows outbound connections from the router on the query port that you assign. </p>
<p>As a caution, dnsmasq runs as user “nobody” on openwrt so it is not allowed to create listening sockets on ports &lt; 1024. Using the standard DNS port 53 for these queries will fail. The failure can be found in the logs. Logread will show an “ignoring nameserver” error line like:<br>   Jan 01 01:01:01 MyRoutersName daemon.warn dnsmasq[3490]: ignoring nameserver 8.8.8.8 - cannot make/bind socket: Permission denied</p>
<p>Do not assign query ports less than 1024 to the queryport. </p>
<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><ul>
<li><p>Project Homepage: <a href="http://thekelleys.org.uk/dnsmasq/doc.html" title="http://thekelleys.org.uk/dnsmasq/doc.html" target="_blank" rel="noopener">http://thekelleys.org.uk/dnsmasq/doc.html</a></p>
</li>
<li><p>Tutorial <a href="http://www.enterprisenetworkingplanet.com/netos/article.php/3377351" title="http://www.enterprisenetworkingplanet.com/netos/article.php/3377351" target="_blank" rel="noopener">http://www.enterprisenetworkingplanet.com/netos/article.php/3377351</a></p>
</li>
<li><p>Tutorial <a href="http://martybugs.net/wireless/openwrt/dnsmasq.cgi" title="http://martybugs.net/wireless/openwrt/dnsmasq.cgi" target="_blank" rel="noopener">http://martybugs.net/wireless/openwrt/dnsmasq.cgi</a></p>
</li>
</ul>
<p><em><a href="#fnt__1">1)</a></em> such as <a href="https://developers.google.com/speed/public-dns/docs/using" title="https://developers.google.com/speed/public-dns/docs/using" target="_blank" rel="noopener">Google Public DNS</a> and <a href="https://www.opendns.com" title="https://www.opendns.com" target="_blank" rel="noopener">OpenDNS</a><em><a href="#fnt__2">2)</a></em> currently, linux /etc/resolv.conf file is limited to three nameservers, <a href="http://manpages.ubuntu.com/manpages/trusty/man5/resolver.5.html" title="http://manpages.ubuntu.com/manpages/trusty/man5/resolver.5.html" target="_blank" rel="noopener">see resolv.conf(5) manpage</a></p>
<div style="clear:both"></div><div class="cc"><p>The <a href="https://blog.naaln.com">Why·Liam·Blog</a> by <a href="https://www.naaln.com" target="_blank" rel="external">WhyLiam</a> is licensed under a <a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="external">Creative Commons BY-NC-ND 4.0 International License</a>.</p><p>由<a href="https://www.naaln.com" target="_blank" rel="external">WhyLiam</a>创作并维护的<a href="https://blog.naaln.com">Why·Liam·Blog</a>采用创作共用<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="external">保留署名-非商业-禁止演绎4.0国际许可证</a>。</p><p>本文首发于<a href="https://blog.naaln.com">Why·Liam·Blog (https://blog.naaln.com)</a>，版权所有，侵权必究。</p><p>本文永久链接：<a href="https://blog.naaln.com/2013/06/dnsmasq/">https://blog.naaln.com/2013/06/dnsmasq/</a></p><p></p></div>
      
    </div>

    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="//ws1.sinaimg.cn/large/006tKfTcgy1fg8gpi7kaaj30by0by74i.jpg" alt="WHY·LIAM wechat" style="width: 200px; max-width: 100%;"/>
    <div>记录生活，研究产品，分享设计，分析数据，讨论科技和商业，不定期扯淡。</div>
</div>

      </div>
    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="//ws1.sinaimg.cn/mw690/006tNc79gy1fm7yqrau7mj30f00ezad5.jpg" alt="WHY·LIAM 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="//ww3.sinaimg.cn/mw690/48910e01gw1evkbfendrjj20ci0ci0uf.jpg" alt="WHY·LIAM 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>WHY·LIAM</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://blog.naaln.com/2013/06/dnsmasq/" title="Dnsmasq">https://blog.naaln.com/2013/06/dnsmasq/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/" rel="external nofollow" target="_blank">CC by-nc-nd 3.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/dnsmasq/" rel="tag"># dnsmasq</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2013/06/boy-you-had-to-believe-that-two-wrongs-can-just/" rel="next" title="少年你要相信负负是可以得正的">
                <i class="fa fa-chevron-left"></i> 少年你要相信负负是可以得正的
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2013/07/sichuan-tibet-spiritual-practice-by-yourself/" rel="prev" title="川藏修行致自己">
                川藏修行致自己 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="//tva2.sinaimg.cn/crop.0.0.998.998.180/48910e01gw1ef5p6etuzdj20rs0rs771.jpg"
                alt="WHY·LIAM" />
            
              <p class="site-author-name" itemprop="name">WHY·LIAM</p>
              <p class="site-description motion-element" itemprop="description">人生若如初見</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">721</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">67</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/liszd" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/whyliam" target="_blank" title="微博" rel="external nofollow"><i class="fa fa-fw fa-weibo"></i>微博</a>
                  
                </span>
              
            </div>
          

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank" rel="external nofollow">
                <img src="/images/cc-by-nc-nd.svg" alt="Creative Commons" />
              </a>
            </div>
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.naaln.com/" title="纳兰主页" target="_blank">纳兰主页</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://photo.naaln.com/" title="纳兰相册" target="_blank">纳兰相册</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2003 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WHY·LIAM</span>

  

  
</div>


  









  <div class="footer-custom">Hosted by <a target="_blank" rel="external nofollow" href="https://pages.coding.me"><b>Coding Pages</b></a></div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="总访客量">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="总访问量">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.2.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.2.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.2.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.2.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.2.0"></script>



  



	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cytklkKc0';
      var conf = 'prod_b1dd516bbb7f3198591656f99d9ace80';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  







  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.2.0"></script>



  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
